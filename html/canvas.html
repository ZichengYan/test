<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.js"></script>
    <style>
        .code {
            vertical-align: middle;
            display: inline-block;
            width: 300px;
            height: 300px;
            border: 1px solid #000;
        }

        .code img {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
<form id="form">
    账号 : <input type="text" value="admin" id="city" name="login_username">
    <br>
    <br>
    密码 : <input type="text" name="login_password" value="123456">
    <br>
    <br>
    <span>验证码</span>
    <input type="text" name="verificationCode">
    <div class="code" id="code"></div>
    <br>
    <br>
    <button id="submit">提交</button>
</form>
<script>
    const width = 300;
    const height = 300;

    /**
     * 随机数
     * @param x 最小值
     * @param y 最大值
     * @returns {Number}
     */
    function getRandomNum(x, y) {
        if (x != '') {
            y = x;
            return Math.round(Math.random() * y);
        }
        return Math.round(Math.random() * y + (x - 0));
    }

    function getRandomColor() {
        const hexColorArray = ['a', 'b', 'c', 'd', 'e', 'f', '1', '2', '3', '4', '5', '6', '7', '8', '9', '0']

        function _getRandomNum() {
            return hexColorArray[getRandomNum(0, 14)];
        }

        return `#${_getRandomNum()}${_getRandomNum()}${_getRandomNum()}${_getRandomNum()}${_getRandomNum()}${_getRandomNum()}`
    }

    function getCode() {
        $.ajax({
            type: "get",
            dataType: 'JSON',
            url: "/verificationCode",
            success: function (data) {
                console.log("data", data);
                getCanvase(data.result.verifiCode);
            },
            error: function (err) {
                console.log(err);
            }
        })
    }

    function getCanvase(code) {
        var canvas = $('<canvas></canvas>')[0];
        canvas.height = height;
        canvas.width = width;
        // var canvas = $('#canvas')[0];
        var ctx = canvas.getContext("2d");

        /*ctx.fillStyle = "#000";
        ctx.fillRect(0, 0, width, height);*/
        for (let i = 0; i < 10; i++) {
            setTimeout(function () {
                for (let i = 0; i <10000; i++) {
                    //设置对象起始点和终点
                    /*let x=getRandomNum(width);
                    let y=getRandomNum(height);
                    ctx.moveTo(x, y);
                    ctx.lineTo(x+1, y+1);//设置样式
                    ctx.lineWidth = 1;
                    ctx.strokeStyle = getRandomColor();
                    //绘制
                    ctx.stroke();*/

                    ctx.fillStyle = getRandomColor();
                    ctx.fillRect(getRandomNum(width), getRandomNum(height), 1, 1);

//                    ctx.beginPath();
                }
            }, 0)

        }
       /* //设置字体样式
        ctx.font = "16px Arial";
        //设置字体填充颜色
        ctx.fillStyle = getRandomColor();
        //从坐标点(50,50)开始绘制文字
        ctx.fillText('', 18, 20);

        var dataURL = canvas.toDataURL('image/jpeg'); //转换图片为dataURL*/
//        $("#code").html(`<img src="${dataURL}" />`);
        $("#code").html(canvas);
//        return dataURL;
    }

    getCanvase();
</script>
</body>
</html>